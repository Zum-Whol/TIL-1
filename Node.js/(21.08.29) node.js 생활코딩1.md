# Node.js 생활코딩1

## Node.js의 등장 배경

- 웹이 등장한 이후 HTML 수동 타이핑에 지쳤고, 방문자가 글을 올리게 하고 싶음
- 그들이 HTML 파일을 직접 수정하는 것은 위험했고, 웹 사이트 소유자만이 콘텐츠 추가 가능

- JavaScript : 1995년 네츠케이프에서 만들었고, 웹 브라우저를 제어하는 프로그래밍 언어
- Node.js : 구글에서 v8 엔진을 오픈소스를 공개하고, 라이언 달은 2008년 이를 기반으로 node.js 만듬
- Node.js를 통해 기존 JavaScript로 웹 이상을 제어할 수 있게 됨

## Node.js 기능
- Node.js 또한 Apache 처럼 웹 서버로 사용 가능 (웹 서버 기능 내장)

## URL의 이해
- 웹어서 1억 개의 정적 파일 보여줄려면 1억 개의 정적 파일이 있어야 함
- 같은 파일을 가지고 서로 다른 페이지를 만들어 보내기 (url이 다름)

### 1. URL의 형식

<img width="600" alt="스크린샷 2021-08-29 오후 10 59 54" src="https://user-images.githubusercontent.com/80403988/131253144-a4b0b794-8b63-4cec-a290-d281346bbeab.png">

- domain name : host라고도 부름

- port : 한 대의 컴퓨터 안에 여러 대의 서버가 있다면, port를 지정하여 어떤 서버와 통신할지 정해줌

- path : 컴퓨터 안에 어떤 디렉토리의 어떤 파일인지 가르킴

- query string : 쿼리 스트링의 값을 변경하면 웹 서버에게 특정 데이터 전달 가능
  - ? 로 시작
  - 값과 값은 & 으로 연결
  - 값의 이름과 값은 = 로 구분

### 2. Query string
- Query string의 값에 따라 Node.js로 만든 웹 서바가 사용자에게 동적으로 생성한 정보 전달
- URL의 Query string에 따라 사용자에게 다른 정보를 보여주기

### URL 관련 문법
- request.url
  - 기능 : url에서 port 뒤의 값을 출력
  - 문법 : ```request.url``` : 하며, query string을 얻을 수 있음

- url.parse (url 모듈 사용)
  - 기능 : url에서 querystring과 path를 가져오기
  - url 모듈 가져오기 : ```let url = require('url')```
  - 공식 문법 : ```url.parse(urlStr, [parseQueryString], [slashesDenoteHost])```
  - Query String의 이름과 값을 객체로 출력 : ```url.parse(request.url, true).query``` (true가 아니면 Query string을 url 문자열 그대로 출력)

### 파일 읽어오기 문법(File System)
- fs.readFile
  - 기능 : 파일의 내용을 가져오기
  - fs 모듈 가져오기 : ```let fs = require('fs')```
  - 공식 문법 : ```fs.readFile(path[, options], callback)```

```js
/* http://localhost:3000/path?id=value 를 주소창에 입력했을 때 id 값을 표시하기 위한 서버 구현 */

/* Data 폴더에는 파일명이 HTML, CSS, JavaScript인 파일이 이미 존재 */

var http = require('http');
var fs = require('fs');
let url = require('url'); // require은 node.js 모듈을 사용하는 키워드

var app = http.createServer(function(request,response){
    var _url = request.url;
    let queryData = url.parse(_url, true).query;
    let title = queryData.id;
    
    console.log(_url)          // /path?id=value
    console.log(queryData)     // { id: 'value' }
    console.log(queryData.id)  // value

  if(_url == '/'){
    title = 'Welcome';
  }
  if(_url == '/favicon.ico'){
    response.writeHead(404);
    response.end();
    return;

  }
  response.writeHead(200);
  fs.readFile(`data/${queryData.id}`, 'utf8', function(err, description){
    let template = `
    <!doctype html>
    <html>
    <head>
      <title>WEB1 - ${title}</title>
      <meta charset="utf-8">
    </head>
    <body>
      <h1><a href="/">WEB</a></h1>
      <ol>
        <li><a href="/?id=HTML">HTML</a></li>
        <li><a href="/?id=CSS">CSS</a></li>
        <li><a href="/?id=JavaScript">JavaScript</a></li>
      </ol>
      <h2>${title}</h2>
      <p>${description}</p>
    </body>
    </html>
    `;
    response.end(template);  
    })
});
app.listen(3000);
```

- fs.readdir
  - 기능 : 폴더에 있는 파일명을 배열의 엘리먼트로 담기
  - 공식 문법 : ```fs.readFile(path[, options], callback)```
  - 콜백함수의 전달인자 : err, files (files에는 파일명이 배열 엘리먼트로 담김)

### 서버로 전송할 양식 만들기
- input, textarea 태그만으로도 브라우저상의 양식을 만들 수 있지만, 서버로 전송하려면 form 태그 필요

- form 태그
  - action 속성에 주소 입력 : 데이터를 받아서 저장할 서버 주소 입력

- input, textarea
  - name 속성이 있어야 서버에서 받았을 때 의미가 있음

- form을 전송하면 url에 쿼리스트링이 생성됨
- localhost:3000/process_create/?title=hi&description=hello
- 그러나 post 요청 전달되는 데이터가 url 주소에 포함/노출되는 것은 좋지 않음 (이걸로 서버 정보 수정 가능)
- form의 속성으로 method="post" 넣어주기 -> url에 전달되는 데이터가 노출되지 않음

```js
<form action="https://localhost:3000/process_create" method="post">
  <p><input type="text" name="title" placeholder="title"></p>
  <p><textarea name="description" placeholder="description"></textarea></p>
  <p><input type="submit"></p>
</form>
```
