# Promise, async-await ë³´ì¶©
- ë“œë¦¼ì½”ë”© ì—˜ë¦¬ ì˜ìƒ ìš”ì•½

***

## ì½œë°±í•¨ìˆ˜ì™€ ë¹„ë™ê¸°

### 1. ì½œë°± í•¨ìˆ˜

- ë™ê¸°ì  ì½œë°± í•¨ìˆ˜
```js
function printImmediately(print) {
  print();
}
printImmediately(() => console.log('hello'));
```

- ë¹„ë™ê¸°ì  ì½œë°± í•¨ìˆ˜
```js
// setTimeoutìœ¼ë¡œ ì‹œê°„ ì„¤ì •

function printWithDelay(print, timeout) {
  setTimeout(print, timeout);
}
printWithDelay(() => console.log('async callback'), 2000);
```

- ì½œë°± ì§€ì˜¥ ì˜ˆì‹œ
```js
class UserStorage {
  loginUser(id, password, onSuccess, onError) {
      setTimeout(()=> {
        if(
          (id === 'jacob' && password === '1234') ||
          (id === 'jiyun' && password === '12345')
        ) {
          onSuccess(id);
        } else {
          onError(new Error('not found'))
        }

      }, 2000);
  }

  getRoles(user, onSuccess, onError) {
    setTimeout(()=> {
      if (user === 'jacob') {
        onSuccess({ name:'jacob', role:'leader'});
      } else {
        onError(new Error('not found'))
      }
    }, 1000);

  }
}
```

***

## Promise

### 1. Promiseëž€?
- Promise : ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë™ê¸° ê°„íŽ¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìžˆëŠ” object
- ìš©ë„ : ì½œë°±í•¨ìˆ˜ ëŒ€ì‹  ìœ ìš©í•˜ê²Œ ì‚¬ìš©

### 2. Promiseì˜ ìƒíƒœì™€ ê²°ê³¼
- ìƒíƒœ(State) : í”„ë¡œì„¸ìŠ¤ê°€ ìˆ˜í–‰ì¤‘ì¸ì§€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ë³´ì—¬ì¤Œ
  - Pending : í”„ë¡œì„¸ìŠ¤ê°€ ìˆ˜í–‰ì¤‘ì¸ ìƒíƒœ

- ê²°ê³¼ : í”„ë¡œì„¸ìŠ¤ê°€ ì™„ë£Œëœ ìƒíƒœ
  - fulfilled : í”„ë¡œì„¸ìŠ¤ê°€ ì™„ë£Œë˜ì–´ ì„±ê³µí•œ ìƒíƒœ
  - rejected : í”„ë¡œì„¸ìŠ¤ê°€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ì‹¤íŒ¨í•œ ìƒíƒœ

### 3. Promiseì˜ íŠ¹ì§•
- Promise ì•ˆì—ëŠ” heavyí•œ ìž‘ì—…ì´ ë“¤ì–´ê°€ëŠ”ë°, ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì´ ìž‘ì—…ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ê·¸ ë™ì•ˆ ë‹¤ë¥¸ ìž‘ì—…ë„ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ìœ„í•¨
- Promise ê°ì²´ë¥¼ ë§Œë“¤ìžë§ˆìž ì½œë°±í•¨ìˆ˜ê°€ ë°”ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í–ˆì„ ë•Œë§Œ ì‹¤í–‰ë  ìˆ˜ ìžˆë„ë¡ í†µì œê°€ í•„ìš”í•œ ê²½ìš°ê°€ ìžˆìŒ
- Promiseì˜ ìƒì„±ìžë¥¼ ë³´ë©´ Promise ì•ˆì— 2ê°œì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ë°›ê²Œ ë˜ì–´ ìžˆìŒ (ì„±ê³µì‹œ ì „ë‹¬í•  resolve, ì‹¤íŒ¨ì‹œ ì „ë‹¬í•  reject)

### 3. Promise ì‚¬ìš©ë²•
- Producerë¥¼ í†µí•œ Promise ìƒì„± : new í‚¤ì›Œë“œì™€ Promise ìƒì„±ìž ì‚¬ìš©
  - ì½œë°±í•¨ìˆ˜ resolve() : ì„±ê³µ ì‹œ ì „ë‹¬í•  ê°’ì„ ê´„í˜¸ ì•ˆì— ìž…ë ¥
  - ì½œë°±í•¨ìˆ˜ reject() : ì‹¤íŒ¨ ì‹œ ì „ë‹¬í•  ê°’ì„ ê´„í˜¸ ì•ˆì— ìž…ë ¥

```js
const promise = new Promise((resolve, reject) => {   // promise ëŠ” í´ëž˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— new í‚¤ì›Œë“œë¡œ ê°ì²´ ìƒì„± ê°€ëŠ¥
    console.log('doing something...');
    setTimeout(() => {
      resolve('jacob');                       // resolve ê´„í˜¸ ì•ˆì—ìžˆëŠ” ê°’ì´ ì „ë‹¬ë¨
      /* reject(new Error('no network')); */  // Error í´ëž˜ìŠ¤ëŠ” ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” í´ëž˜ìŠ¤ì´ë©° ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê±¸ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´
    }, 2000);
  });
```

- Consumerë¥¼ í†µí•œ Promise ì‚¬ìš© : Consumerë¬¸ ì•ˆì— ì½œë°±í•¨ìˆ˜ë¥¼ ë„£ì–´ì„œ ê°’ì„ ë°›ì•„ì˜¤ê¸° 
  - then : Promiseê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë  ë•Œ, resolve() ê´„í˜¸ ì•ˆì˜ ê°’ì„ ë°›ì„ ë•Œ ì‚¬ìš©

  - catch : promise ìˆ˜í–‰ì´ ì‹¤íŒ¨í•  ê²½ìš°, reject() ê´„í˜¸ ì•ˆì˜ ê°’ì„ ë°›ì„ ë•Œ ì‚¬ìš©

  - finally : ì„±ê³µ/ì‹¤íŒ¨ì™€ ìƒê´€ì—†ì´ ë§ˆì§€ë§‰ì— ê¸°ëŠ¥ì„ ìˆ˜í–‰

  - Consumerë¬¸ì—ì„œ returnì„ í•˜ë©´ ë‹¤ìŒ consumer ë¬¸ì€ ì´ return ê°’ì„ ë°›ìŒ

```js
promise.then(value => {   // valueëŠ” resolve ì½œë°± í•¨ìˆ˜ ì•ˆì— ë“¤ì–´ìžˆëŠ” 'jacob' ì´ ë¨
      console.log(value);
  })                     // ìœ„ì˜ thenì€ ê²°êµ­ ë˜‘ê°™ì€ promiseë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì— ë°”ë¡œ catch ì‚¬ìš© ê°€ëŠ¥ - ì´ê²ƒì´ promise chaining
  .catch(error=> {       // catchë¬¸ì€ promise ìˆ˜í–‰ì´ ì‹¤íŒ¨í•  ê²½ìš° rejectê°’ì„ ë°›ì„ ë•Œ ì‚¬ìš©
      console.log(error)
  })
  .finally(()=> {            // finallyëŠ” ìµœê·¼ë° ë“±ìž¥í•œ ê²ƒìœ¼ë¡œ ì„±ê³µ/ì‹¤íŒ¨ì™€ ìƒê´€ì—†ì´ ê¸°ëŠ¥ì„ ë§ˆì§€ë§‰ì— ìˆ˜í–‰
      console.log('finally');
  });
  
```

- Promise Chaining
```js
  const fetchNumber = new Promise((resolve, reject) => {
      setTimeout(() => resolve(1), 1000);
  });
  
  fetchNumber
  .then(num => num * 2)   // numì€ 2ê°€ ë¨  // returnì„ í•´ì£¼ë©´ ê·¸ ê°’ì„ ë‹¤ìŒ .thenì—ì„œ ë°›ìŒ
  .then(num => num*3)     // numì€ 6ì´ ë¨
  .then(num=> {  // thenì€ ë˜ ë‹¤ë¥¸ promiseë¥¼ ë¦¬í„´í•  ìˆ˜ ìžˆìŒ
      return new Promise((resolve, reject) => {
          setTimeout(() => resolve(num - 1),1000);  // numì€ 5ê°€ ë¨
      });
  })
  .then (num => console.log(num));
```

- Error Handling
```js
const getHen = () =>
  new Promise((resolve, reject) => {
      setTimeout(() => resolve('ðŸ”'),1000);
  });
const getEgg = hen =>
  new Promise((resolve, reject) => {
      setTimeout(() => resolve(`${hen} => ðŸ¥š`), 1000);
  });
const cook = egg =>
  new Promise((resolve, reject) => {
      setTimeout(() => resolve(`${egg} => ðŸ³`), 1000);
  });

getHen()
.then(hen => getEgg(hen))         // .then(getEgg)ë¡œ í‘œê¸° ê°€ëŠ¥ : ë°›ì•„ì˜¤ëŠ” ê°’ì„ ì½œë°±í•¨ìˆ˜ì—ì„œ ë°”ë¡œ í˜¸ì¶œí•˜ëŠ” ê²½ìš°
.catch(error => {                 // ì—ëŸ¬í•¸ë“¤ë§ : ì¤‘ë‹¨ì— ë‹¬ê±€ì„ ë°›ì„ ìˆ˜ ì—†ìœ¼ë©´ ë¹µìœ¼ë¡œ ëŒ€ì²´
    return 'ðŸ¥–';
})
.then(egg => cook(egg))           // .then(cook)
.then(meal => console.log(meal)) // .then(console.log)
.catch(console.log);
```

***

## async - await
