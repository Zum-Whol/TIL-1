# 웹 서버

***

## CORS (Cross Origin Resource Sharing)
- CORS : Cross Origin에서 리소스(서버자원)을 요청하여 사용함
- 브라우저는 보안상 이후로 CORS를 제한해서, 서버가 허용하는 경우에만 가능
- 등장 배경
  - 과거에는 서버 내 저장된 클라이언트에 관한 정보를 클라이언트가 받아봄(Origin이 서버에 있음)
  - 이후 Single Page Application 등 기술이 고도화되어 다른 서버의 리소스를 필요로 하는 복잡한 상황이 생김
  - 다양한 Origin에서 정보를 주고받게 되는 CORS 등장

- ```OPTIONS``` 메소드 : 서버에서 허락하는 CORS 조건들을 다 맞추고 있는지 사전에 확인하는 요청 (preflight : 사전 전달)
  - 서버가 CORS 허용하는 조건의 코드 예시
  ```js
  const defaultCorsHeaders = {
  'access-control-allow-origin' : '*',                                 // 모든 도메인(*)에서 우리 서버로 도메인 크로스 오리진 요청 가능
  'access-control-allow-origin' : www.google.com                       // 구글에만 크로스 오리진 요쳥 가능
  'access-control-allow-methods' : 'GET, POST, PUT, DELETE, OPTIONS',  // 허락하는 메소드 종류
  'access-control-allow-headers' : 'content-type, accept'              // 헤더에는 content-type과 accept만 사용 가능
  'access-control-max-age' : 10                                        // preflight request는 10초 까지 허용됨
  };
  ```

***

## Node JS 통한 서버 구현
- HTTP 트랜잭션 해부 : https://nodejs.org/ko/docs/guides/anatomy-of-an-http-transaction/

### 1. 서버 생성

```js
const http = require('http');

const port = 3000;
const ip = 'localhost';

const server = http.createServer((request, response) => {
  // 여기서 작업이 진행됩니다!
});
```
- HTTP 모듈 불러오기
  - 코드 : ```const http = require('http')```

- port와 ip 지정
  - port 예시 코드 : ```const port = 3000```
  - ip 예시 코드 : ```const ip = 'localhost'```

- server라는 함수 생성
  - 코드 : ```const server = http.createServer(function(request, response) { 내용 }```
  - 매개변수 : ```request```, ```response```

### 2. 서버 호출
```js
server.listen(port, function(error) {
  if (error) {
    console.log('Something went wrong', error)
  } else {
    console.log('Server is listening on port' + port)
  }
}
)
```
- 메소드 문법 : ```server.listen(port, ip, 함수)``` - ip와 함수는 생략 가능  
- 서버 호출을 해줘야 server함수의 response 매개변수를 사용할 수 있음

### 3. Request (요청 객체)

- 요청 body
  - 기능 : 핸들러에 전달된 body 데이터 받기
  - 원리 : 스트림의 ```'data'```와 ```'end'``` 이벤트에 이벤트 리스너 등록해 데이터 받기
  - 코드
  ```js
  let body = [];
  request.on('data', (chunk) => {
    body.push(chunk);
  }).on('end', () => {
    body = Buffer.concat(body).toString();
    // 여기서 `body`에 전체 요청 바디가 문자열로 담겨있습니다.
    // Buffer는 각 'data'이벤트에서 발생시킨 chunk이며, 문자열 데이터
  });
  ```

### 4. Response (응답 객체)

```js
response.writeHead(200, { `counter-Type` : `text/html`})
response.write('Hello Noede')
response.end()
```

- writeHead 메소드
  - 기능 : 응답 헤더 설정
  - 코드 : ```writeHead(상태코드, object)```

- write 메소드
  - 기능 : 클라이언트에 내용 전달
  - 코드 : ```response.write(string)```

- end 메소드
  - 기능 : 응답 개체 내용 마무리
  - 코드 : ```response.end(string)```
