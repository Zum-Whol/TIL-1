# NoSQL - MongoDB

***

## NoSQL
- 데이터를 행과 열이 아니 체계적인 방식으로 저장

### 도큐먼트 데이터베이스
- 도큐먼트 데이터베이스 : NoSQL 기반 비관계형 데이터베이스의 한 유형
- 데이터를 테이블이 아닌 문서처럼 저장하는 데이터베이스이며 JSON 유사 형식으로 문서화
- 각 도큐먼트는 데이터를 ```필드-값```형태로 가지고 있으며 컬렉션이라는 그룹으로 묶어 관리

***

## MongoDB
- NoSQL 도큐먼트 데이터베이스 : 데이터를 도큐먼트에 저장하고 도큐먼트는 컬렉션에 저장됨

### 1. Atlas Cloud
- MongoDB에서는 아틀라스(Atlas)로 클라우드에 데이터베이스를 설정
- 아틀라스는 GUI와 CLI로 데이터를 시각화, 분석, 내보내기, 그리고 빌드하는 데에 사용할 수 있음
- 아틀라스 사용자는 클러스터를 배포 할 수 있으며, 클러스터는 그룹화된 서버에 데이터를 저장 

### 2. 클러스터 배포 (Cluster Deployment)
- 클러스터(데이터베이스) : 인스턴스들의 모임으로 하나의 시스템처럼 작동. 데이터를 저장하는 서버 그룹으로 여러 대의 컴퓨터를 네트워크를 통해 연결하여 하나의 단일 컴퓨터처럼 동작하도록 제작한 컴퓨터
- 인스턴스 : 로컬 또는 클라우드에서 특정 소프트웨어를 실행하는 단일 머신으로 MongoDB에서는 데이터베이스
- 레플리카 세트 : 동일한 데이터를 저장하는 소수의 연결된 머신으로, 레플리카 세트 중 하나에 문제가 발생하더라도 데이터를 그대로 유지할 수 있음

### 3. MongoDB Document
- 도큐먼트는 객체와 같이 데이터를 필드-값 쌍(Field - Value pair)으로 저장하고 구성
- 도큐먼트에서 필드는 데이터의 고유한 식별자이고, 값은 주어진 식별자와 관련된 데이터를 뜻합
```
/* 이러한 도큐먼트 모음을 컬렉션이라 지칭*/
{
<field> : <value>,
<field> : <value>,
"name" : "kimcoding",
"title" : "Chapter Lead"
"age" : 30
}
```
- 용어
  - 도큐먼트(Document) : 필드 - 값 쌍으로 저장된 데이터

  - 필드(Field) : 데이터 포인트를 위한 고유한 식별자

  - 값(Value) : 주어진 식별자와 연결된 데이터

  - 컬렉션(Collection) : MongoDB의 도큐먼트로 구성된 저장소로 도큐먼트 간의 공통 필드가 있음

  - 데이터베이스 > 콜렉션 > 도큐먼트

### 4. JSON과 BSON 양식
- shell을 이용하여 도큐먼트를 조회하거나 업데이트 할 때, 도큐먼트는 JSON(JavaScript Object Notation) 형식으로 출력
```
/* MongoDB의 도큐먼트는 _id 값이 필수로 있어야 함*/

"_id" : "123",
"date" : DATE("2021-01-01"),
"user_id" : "jacob123",
"user_name" : "jiyun",
"comments" : "hello"
```

- BSON(Binary JSON) : JSON 보다 메모리 사용이 효율적이며 빠르고, 가볍고, 유연
- 백업과 백업 저장을 하기 위해서라면 가볍고 빠른 BSON의 형태를 사용하는 편이 좋음
- 데이터를 내보낸 후, 조회를 하거나 출력을 해야한다면 사람이 읽기 쉬운 JSON의 형식이 적절

## 데이터 기져오기 & 불러오기 문법

### 1. Importing(데이터 가져오기) 명령어
- mongoimport (JSON 형식)
  - 문법 : 기존 데이터를 삭제하는 drop 쿼리문은 선택적으로 사용
  ```
  mongoimport --uri "<Atlas Cluster URI>"
              --drop=<filename>.json
  ```

- mongostore (BSON 형식)
  - 문법 : 기존 데이터를 삭제하는 drop 쿼리문은 선택적으로 사용
  ```
  mongostore --uri "<Atlas Cluster URI>"
             --drop dump
  ```

### 2. Export(데이터 출력, 내보내기) 명령어
- mongoexport (JSON 형식)
  - 문법  : 데이터베이스의 컬렉션 이름, 파일 이름까지 정확하게 작성
  ```
  mongoexport --uri "<Atlas Cluster URI>"
              --collection=<collection name>
              --out=<filename>.json
  ```

- mongodump (BSON 형식)
  - 문법 : ```mongodump --uri "<Atlas Cluster URI>"```

## Database와 Collection 문법

- show dbs
 - 기능 : 데이터베이스 목록 보여주기
 - 문법 : ```show dbs```

- use dbs
  - 기능 : 해당 데이터베이스에 접속하기
  - 문법 : ```use dbs```

- show collections
  - 기능 : 해당 데이터베이스 내의 컬렉션을 보여주기
  - 문법 : ```show collections```

- collection.drop
  - 기능 : 해당 컬렉션을 삭제하기
  - 문법 : ```db.collection명.drop()```

## Document의 CRUD 문법

### 1. Create (insert)
- 기능 : 해당 컬렉션에 도큐먼트 추가하기
- 문법 : ```db.컬렉션명.insert({ 필드1 : 값1, 필드2 : 값2... })```
- 문법 (여러 도큐먼트 추가) : ```db.컬렉션명.insert([{필드1 : 값1}, {필드2 : 값2}, {필드3 : 값3}])```

### 2. READ (find)
- 기능 : 해당 컬렉션의 도큐먼트롤 조회하기
- 문법 (파일 모두 조회) : ```db.컬렉션명.find()```
- 문법 (조건에 맞는 파일 조회) : ```db.컬렉션명.find({필드1 : 값1, 필드2 : 값2...})```

### 3. UPDATE (updateOne, updateMany)
- 기능 : 해당 컬렉션에서 조건에 해당하는 다큐먼트의 특정 필드 값을 변경
- 문법 ($inc 연산자) : ```db.컬렉션명.updateMany({"필드 : 값"}, {"$inc" : {"필드명 : number}})``` 
  - 첫 번째 객체는 변경할 도큐먼트의 조건에 해당하며, 두번째 객체에서 해당 필드의 값이 number만큼 증가

- 문법 ($set 연산자) : ```db.컬렉션명.updateOne({"필드 : 값"}, {"$set" : {"필드명 : value}})```
  - 해당 필드의 값을 value로 변경하기

### 4. DELETE (deleteOne, deleteMany)
- 기능 : 해당 컬렉션에서 조겐에 해당하는 도큐먼트 삭제
- 문법 : ```db.컬렉션명.deleteOne({필드 : 값})```
- 문법 : ```db.컬렉션명.deleteMany({필드 : 값})```

